---
title: "Title"
author: "Examination number: Y3868011"
output: html_document
bibliography: reference.bib
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)
```

```{r pkg}
library(tidyverse)      # tidying data and summarizing
library(dplyr)
library(factoextra)     # for visualization (check still using this)
library(GGally)         # PCA visualization
library(palmerpenguins) # PCA visualization
library(corrr)          # PCA 

```

# 1 Introduction
Dementia is a syndrome and includes many different neurodegenerative brain disorders, triggered by disease of the brain and causing loss of brain function [@Dening2015-pp]. 1 in 6 people over the age of 80 have dementia, which currently there is no cure for. Symptoms of dementia vary from physical to behavioral, including agitation and depression, as well as depleting memory and cognitive function [@Cerejeira2012-qr; @Shih2014-op]. 



[@R-tidyverse]

# 2 Methods

[@R-rmarkdown]
[@R-base]

## 2.1 Data Description
There are two separate CSV files: patient_data_raw.csv (../data_raw/patient_data_raw.csv) and visit_data_raw.csv (../data_raw/visit_data_raw.csv).

Researchers collected this data with the aim of predicting dementia rating and grouping. The files include data on 150 subjects, 88 females and 62 males, all between the ages if 60 and 96 years old. Multiple records for the same subject indicates following visits at least a year on from the previous. For reference all subjects are right-handed. In the patient data, 

Each row is a subject and data from their individual visit. There are two data files and the column descriptions are as follows:

**Patient**
* Subject ID
* Group (demented, nondementded, converted)
  + demented subjects are demented throughout the study, as for nondemented. Subjects who were nondemented on their first visit and demented on following visits are characterized as converted 
* m_f indicates gender
* educ states the years of education of the subject
* ses is the 'socioeconomic status' as assessed by the Hollingshead Index of Social Position
  + This is classified into categories from 1 (highest status) to 5 (lowest status)

**Visit**
* Subject ID
* MRI number
* Visit indicates the number if visit
* Age
* mmse is the Mini-Mental State Examination score (0 = worst to 30 = best)
* cdr indicates the clinical dementia rating
  + 0 = no dementia, 0.5 = very mild Alzheimers disease, 1 = mild Alzheimers disease, 2 = moderate Alzheimers disease
* etiv is the estimated total intacranial volume measured in mm^{3}
* nwbv is the normalized whole-brain volume, expressed as a percent of all voxels in the atlas-masked image that are labeled as gray or white matter by the automated tissue segmentation process
* asf is the Atlas scaling factor (unitless). It is a computed scaling factor which transforms native-space brain and skull to the atlas target 




```{r data-import}
# Creating file for the patient data
file_patient <- "../data_raw/patient_data_raw.csv"
# 
patient <- read.csv(file_patient) %>%
  janitor::clean_names()

# Creating file for visit data
file_visit <- "../data_raw/visit_data_raw.csv"
#
visit <- read.csv(file_visit) %>%
  janitor::clean_names()

```

## 2.2 Data preparation and tidying
talk about how the imgaing sessions was 373 but now 354 due to NA values 

```{r checking structure of datasets}
str(visit)
# 373 obs and 9 variables
str(patient)
# 150 obs and 5 variables
```

```{r data filtering}
# mri_number and visit provide the same information (1-4)
# removing column mri_number as it is irrelevant
visit <- visit %>%
  select(-mri_number)

```

```{r dataset combining}
# combining both datasets and retaining all values
data <- dplyr::full_join(patient, visit, by = "subject_id")
```

```{r removing rows with NA}
data <- data %>% drop_na()
str(data)
```


## 2.3 Visualisation using Principal Components Analysis
``` {r pca prep}
# Arranging data for ease of creating data frame for pca
# All columns to be included in pca to be first, then other columns to follow
data <- data %>%
  select(subject_id, age, mmse, e_tiv, n_wbv, asf, everything())

data_active <- data[1:354, 2:6]
#checking 
head(data_active[, 1:5])


```
## 2.4 Other method of analysis


## 2.5 Another type of plot



# 3 Results

## 3.1 Principal Components Analysis
``` {r carrying out PCA}
pca <- data_active %>%
  prcomp(scale. = TRUE)
fviz_eig(pca)


```


```{r pca another graph}
fviz_pca_var(pca,
             col.var = "contrib", # Color by contributions to the PC
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE     # Avoid text overlapping
             )
```
```{r pca}
pca3 <- data %>%
  select(-group, -m_f, -subject_id) %>%
  prcomp(scale. = TRUE)


data_corr <- data %>%
  dplyr::select(where(is.numeric)) %>%
  correlate() %>%
  rearrange()
data_corr

data %>%
  select(group, where(is.numeric)) %>% 
  GGally::ggpairs(aes(color = group),
          columns = c("e_tiv", "educ", 
                      "visit", "age",
                      "cdr", "mmse",
                      "n_wbv", "ses",
                      "asf")) +
  scale_colour_manual(values = c("darkorange","purple","cyan4")) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"))

```

## 3.2 

## 3.3


# References

```{r references, message=FALSE, warning=FALSE, include=FALSE}
#creating a location for references and used packages in a  .bib file 
knitr::write_bib(c("tidyverse", "Dening", "Cerejeira", "Shih", "Rmarkdown", "R-base"), 
                 width = 60, file = "references.bib")

```





